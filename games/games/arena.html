<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>勇者竞技场（内置演示） - US Game Hub</title>
  <link rel="stylesheet" href="/assets/style.css"/>
</head>
<body>
  <div class="container">
    <div class="breadcrumb"><a href="/">首页</a> / 动作 / 勇者竞技场（内置演示）</div>
    <div class="card">
      <h1>勇者竞技场（内置演示）</h1>
      <p class="muted">WASD / 方向键移动，J 攻击，K 冲刺。这个演示不依赖外部网站，保证可玩。</p>
      <div class="canvas-wrap"><canvas id="game" width="960" height="540"></canvas></div>
      <p style="margin-top:10px"><span class="badge">动作</span><span class="badge">演示</span><span class="badge">H5</span></p>
    </div>
  </div>

<script>
const c=document.getElementById('game'),ctx=c.getContext('2d'),W=c.width,H=c.height;
let keys={},p={x:W/2,y:H/2,r:18,vx:0,vy:0,spd:3.2,atk:false,dodge:0,color:'#34d399'};
addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
let mobs=Array.from({length:12},()=>({x:Math.random()*W,y:Math.random()*H,r:12+Math.random()*10,c:'#93c5fd'}));
let fx=[];
function step(){
  // move
  let ax=0,ay=0;
  if(keys['w']||keys['arrowup'])ay-=1;
  if(keys['s']||keys['arrowdown'])ay+=1;
  if(keys['a']||keys['arrowleft'])ax-=1;
  if(keys['d']||keys['arrowright'])ax+=1;
  const L=Math.hypot(ax,ay)||1, S=p.spd*(p.dodge>0?2.4:1);
  p.vx=(ax/L)*S; p.vy=(ay/L)*S;
  p.x=clamp(p.x+p.vx,p.r,W-p.r); p.y=clamp(p.y+p.vy,p.r,H-p.r);

  if(keys['j']&&!p.atk){ p.atk=true; setTimeout(()=>p.atk=false,160); }
  if(keys['k']&&p.dodge<=0){ p.dodge=18; } if(p.dodge>0)p.dodge--;

  // mobs chase
  mobs.forEach(m=>{ const dx=p.x-m.x,dy=p.y-m.y,d=Math.hypot(dx,dy)||1; m.x+=dx/d*0.5; m.y+=dy/d*0.5; });

  // attack hit
  if(p.atk){
    const ang=Math.atan2(p.vy||0,p.vx||1);
    mobs=mobs.filter(m=>{
      const dx=m.x-p.x,dy=m.y-p.y,d=Math.hypot(dx,dy),a=Math.atan2(dy,dx);
      const inArc=Math.abs(((a-ang+Math.PI*3)%(Math.PI*2))-Math.PI)<Math.PI/3;
      if(d<62&&inArc){
        for(let i=0;i<12;i++)fx.push({x:m.x,y:m.y,vx:(Math.random()-0.5)*4,vy:(Math.random()-0.5)*4,t:26,c:'#f472b6'});
        return false;
      }
      return true;
    });
    while(mobs.length<12)mobs.push({x:Math.random()*W,y:Math.random()*H,r:12+Math.random()*10,c:'#93c5fd'});
  }

  fx.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.t--;}); fx=fx.filter(p=>p.t>0);
}
function draw(){
  ctx.fillStyle='#0b1020'; ctx.fillRect(0,0,W,H);
  ctx.strokeStyle='#111827'; ctx.globalAlpha=.6;
  for(let x=0;x<W;x+=40){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H);ctx.stroke();}
  for(let y=0;y<H;y+=40){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();}
  ctx.globalAlpha=1;

  mobs.forEach(m=>{ctx.fillStyle=m.c;ctx.beginPath();ctx.arc(m.x,m.y,m.r,0,Math.PI*2);ctx.fill();});
  ctx.fillStyle=p.dodge>0?'#22d3ee':p.color; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
  if(p.atk){const a=Math.atan2(p.vy||0,p.vx||1);ctx.strokeStyle='#fde047';ctx.lineWidth=6;ctx.beginPath();ctx.arc(p.x,p.y,44,a-Math.PI/3,a+Math.PI/3);ctx.stroke();}
  fx.forEach(e=>{ctx.fillStyle=e.c;ctx.fillRect(e.x,e.y,2,2);});
}
(function loop(){ step(); draw(); requestAnimationFrame(loop); })();
</script>
</body>
</html>
